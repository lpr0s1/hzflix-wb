<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="manifest" href="/app/manifest.json">
  <meta name="theme-color" content="#0f172a">
  <title>HzFlix Live</title>



  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
<script>
  window.OneSignalDeferred = window.OneSignalDeferred || [];
  OneSignalDeferred.push(async function(OneSignal) {
    await OneSignal.init({
      appId: "75a0d415-186c-4407-9c17-f184db7e3529",
      safari_web_id: "web.onesignal.auto.00e855ed-5f66-45b8-ad03-54b1e142944e",
      notifyButton: {
        enable: true,
      },
    });
  });
</script>

  <style>
    @import url('https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css');
    :root{--bg:#0b1220;--card:#0f172a;--accent:#ff4d6d}
    html,body,#app{height:100%}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Helvetica Neue",Arial}
    .container{max-width:1200px;margin:0 auto;padding:20px}
    .header{display:flex;align-items:center;justify-content:space-between;gap:16px}
    .brand{display:flex;align-items:center;gap:12px;color:#fff}
    .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#ff7a7a,#6d28d9);display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff}
    .title{font-size:18px;font-weight:600}
    .controls{display:flex;gap:10px;align-items:center}
    .btn{background:linear-gradient(90deg,var(--accent),#7c3aed);color:#fff;padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:600}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.04);padding:14px;border-radius:12px}
    .player-wrapper{position:relative;padding-top:56.25%;overflow:hidden;border-radius:10px;background:#000}
    .player-wrapper iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:0}
    .meta{display:flex;align-items:center;justify-content:space-between;margin-top:12px;color:#cbd5e1}
    .small{font-size:13px;color:#94a3b8}
    .actions{display:flex;gap:8px}
    .info{color:#e2e8f0}
    .install-banner{position:fixed;left:20px;right:20px;bottom:22px;background:linear-gradient(90deg,#06202a,#0b1220);padding:12px;border-radius:12px;display:flex;align-items:center;gap:12px;border:1px solid rgba(255,255,255,0.03)}
    .hidden{display:none}
    .footer{margin-top:18px;color:#9aa8bf;font-size:13px}
    .badge{background:#12263b;color:#a3e635;padding:6px 8px;border-radius:999px;font-weight:700;font-size:12px}
  </style>
</head>
<body class="bg-gradient-to-b from-black via-[#04111a] to-[#071124] text-white">
  <div id="app" class="container">
    <header class="header">
      <div class="brand">
        <div class="logo">HZ</div>
        <div>
          <div class="title">HzFlix Live</div>
          <div class="small">hanzo_x65 — Diffusions en direct</div>
        </div>
      </div>
      <div class="controls">
        <button id="onesignal-subscribe" class="btn">Activer notifications</button>
        <button id="installBtn" class="btn hidden">Installer</button>
      </div>
    </header>

    <main class="card" style="margin-top:18px">
      <div class="player-wrapper" id="player">
        <iframe src="https://kick.com/hanzo-x65" allowfullscreen="true" sandbox="allow-scripts allow-same-origin allow-forms" referrerpolicy="no-referrer"></iframe>
      </div>

      <div class="meta">
        <div>
          <div class="info">Direct Live</div>
          <div class="small">Regarde les lives et films diffusés via Kick</div>
        </div>
        <div class="actions">
          <div class="badge">LIVE</div>
        </div>
      </div>

      <div class="footer">
        Ce site peut être installé comme application web. Les notifications push sont gérées par OneSignal.
      </div>
    </main>
  </div>

  <div id="installBanner" class="install-banner hidden">
    <div style="flex:1">
      <div style="font-weight:700">Installer HzFlix</div>
      <div style="font-size:13px;color:#9aa8bf">Accède directement au live depuis ton écran d accueil</div>
    </div>
    <button id="installBannerBtn" class="btn">Installer</button>
  </div>

  <script>
    const subscribeBtn = document.getElementById('onesignal-subscribe');
    function log(...a){ console.log('[HzFlix]', ...a) }

    subscribeBtn.addEventListener('click', async () => {
      if (!window.OneSignal) { log('OneSignal SDK non chargé'); alert('SDK OneSignal non chargé'); return; }
      try {
        OneSignalDeferred = OneSignalDeferred || [];
        OneSignalDeferred.push(async function(OneSignal) {
          const isEnabled = await OneSignal.isPushNotificationsEnabled().catch(()=>false);
          log('isPushNotificationsEnabled:', isEnabled);
          if (isEnabled) {
            subscribeBtn.textContent = 'Notifications activées';
            subscribeBtn.disabled = true;
            try { await OneSignal.sendTags({ channel: "test" }); log('tag sent already enabled'); } catch(e){ log('tag error', e) }
            return;
          }

          await OneSignal.showNativePrompt().catch(err=>{ log('showNativePrompt err', err); });
          const subscribed = await OneSignal.isPushNotificationsEnabled().catch(()=>false);
          log('subscribed:', subscribed);
          if (subscribed) {
            subscribeBtn.textContent = 'Notifications activées';
            subscribeBtn.disabled = true;
            try { await OneSignal.sendTags({ channel: "test" }); log('tag sent after manual prompt'); } catch(e){ log('tag error', e) }
          } else {
            alert('Inscription refusée ou échouée');
          }
        });
      } catch (err) {
        log('OneSignal error:', err);
        alert('Erreur OneSignal, regarde la console');
      }
    });

    window.addEventListener('load', ()=>{ console.log('OneSignal present:', !!window.OneSignal); });

    // PWA install prompt handling
    window.addEventListener('beforeinstallprompt', e=>{
      e.preventDefault();
      window.deferredInst = e;
      document.getElementById('installBtn').classList.remove('hidden');
      document.getElementById('installBanner').classList.remove('hidden');
    });
    document.getElementById('installBtn').addEventListener('click', async ()=>{
      if(!window.deferredInst) return;
      window.deferredInst.prompt();
      await window.deferredInst.userChoice;
      window.deferredInst = null;
      document.getElementById('installBtn').classList.add('hidden');
      document.getElementById('installBanner').classList.add('hidden');
    });
    document.getElementById('installBannerBtn').addEventListener('click', async ()=>{
      if(!window.deferredInst) return;
      window.deferredInst.prompt();
      await window.deferredInst.userChoice;
      window.deferredInst = null;
      document.getElementById('installBtn').classList.add('hidden');
      document.getElementById('installBanner').classList.add('hidden');
    });
  </script>
</body>
</html>


