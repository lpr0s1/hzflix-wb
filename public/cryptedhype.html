<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>cryptedhype ‚Äì Chiffrement & D√©chiffrement</title>
  <meta name="description" content="cryptedhype : chiffrez et d√©chiffrez vos fichiers (.txt, .pdf, .jpg, .apk‚Ä¶) en PGP directement dans votre navigateur.">
  <meta name="keywords" content="PGP,chiffrement,cryptographie,fichiers">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Couleurs sombres et accent rouge -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #121212; }
    .card { background-color: #1f1f1f; }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start p-6 text-gray-100">

  <h1 class="text-5xl font-extrabold mb-10 text-red-500">cryptedhype</h1>

  <!-- Card Chiffrement -->
  <div class="card rounded-xl shadow-lg p-6 w-full max-w-lg mb-12 transform transition hover:scale-[1.02]">
    <h2 class="text-2xl font-bold mb-4 text-red-400">üîê Chiffrer un fichier</h2>
    <input
      id="encrypt-input"
      type="file"
      class="w-full mb-4 text-sm file:bg-red-600 file:text-white file:px-4 file:py-2 file:rounded cursor-pointer"
    />
    <div id="encrypt-result" class="flex flex-col space-y-4"></div>
  </div>

  <!-- Card D√©chiffrement -->
  <div class="card rounded-xl shadow-lg p-6 w-full max-w-lg transform transition hover:scale-[1.02]">
    <h2 class="text-2xl font-bold mb-4 text-red-400">üîì D√©chiffrer un fichier</h2>
    <input
      id="decrypt-input"
      type="file"
      class="w-full mb-2 text-sm file:bg-red-600 file:text-white file:px-4 file:py-2 file:rounded cursor-pointer"
    />
    <textarea
      id="private-key"
      rows="4"
      placeholder="Collez ici votre cl√© priv√©e PGP"
      class="w-full mb-4 p-3 bg-gray-700 text-sm text-white rounded placeholder-gray-400"
    ></textarea>
    <button
      id="decrypt-btn"
      class="w-full py-3 bg-red-600 rounded text-white font-semibold transition transform hover:bg-red-700 hover:scale-105"
    >
      D√©chiffrer
    </button>
    <div id="decrypt-result" class="flex flex-col space-y-4 mt-4"></div>
  </div>

  <!-- OpenPGP.js -->
  <script src="https://cdn.jsdelivr.net/npm/openpgp@5.7.0/dist/openpgp.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // V√©rifier la pr√©sence d'OpenPGP
      if (typeof openpgp !== 'object') {
        alert('Impossible de charger OpenPGP.js');
        return;
      }

      // ‚Äî‚Äî‚Äî CHIFFREMENT ‚Äî‚Äî‚Äî
      const encInput = document.getElementById('encrypt-input');
      const encResult = document.getElementById('encrypt-result');

      encInput.addEventListener('change', async () => {
        encResult.innerHTML = '';
        const file = encInput.files[0];
        if (!file) return;

        try {
          // Lire fichier binaire
          const data = new Uint8Array(await file.arrayBuffer());

          // G√©n√©rer paire PGP
          const { privateKey: privArmored, publicKey: pubArmored } =
            await openpgp.generateKey({
              userIDs: [{ name: 'cryptedhype User', email: 'user@hzflix.online' }],
              curve: 'curve25519'
            });

          // Cr√©er message binaire
          const message = await openpgp.createMessage({ binary: data });
          const publicKey = await openpgp.readKey({ armoredKey: pubArmored });

          // Chiffrer en binaire
          const encryptedBinary = await openpgp.encrypt({
            message,
            encryptionKeys: publicKey,
            format: 'binary'
          });

          // Lien de t√©l√©chargement du fichier chiffr√©
          const blob = new Blob([encryptedBinary], { type: 'application/pgp-encrypted' });
          const linkEnc = document.createElement('a');
          linkEnc.href = URL.createObjectURL(blob);
          linkEnc.download = file.name + '.pgp';
          linkEnc.textContent = '‚¨áÔ∏è T√©l√©charger le .pgp';
          linkEnc.className = 'text-red-400 hover:underline';

          // Afficher cl√© priv√©e + bouton copier
          const wrapper = document.createElement('div');
          wrapper.className = 'mt-4 flex flex-col space-y-2';

          const pre = document.createElement('pre');
          pre.textContent = privArmored;
          pre.className = 'bg-gray-700 text-white p-3 text-xs overflow-auto max-h-56 rounded';

          const copyBtn = document.createElement('button');
          copyBtn.textContent = 'üìã Copier la cl√© priv√©e';
          copyBtn.className = 'self-start px-4 py-2 bg-red-600 text-white rounded transition hover:bg-red-700';
          copyBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(privArmored);
            copyBtn.textContent = '‚úÖ Cl√© copi√©e';
          });

          wrapper.append(pre, copyBtn);
          encResult.append(linkEnc, wrapper);

        } catch (err) {
          alert('Erreur lors du chiffrement : ' + err.message);
        }
      });

      // ‚Äî‚Äî‚Äî D√âCHIFFREMENT ‚Äî‚Äî‚Äî
      const decInput = document.getElementById('decrypt-input');
      const decBtn = document.getElementById('decrypt-btn');
      const decResult = document.getElementById('decrypt-result');
      const privTextarea = document.getElementById('private-key');

      decBtn.addEventListener('click', async () => {
        decResult.innerHTML = '';
        const file = decInput.files[0];
        const privArmored = privTextarea.value.trim();

        if (!file || !privArmored) {
          return alert('Fichier chiffr√© ET cl√© priv√©e requis.');
        }

        try {
          const encryptedData = new Uint8Array(await file.arrayBuffer());
          const privateKeyObj = await openpgp.readPrivateKey({ armoredKey: privArmored });
          const message = await openpgp.readMessage({ binaryMessage: encryptedData });

          const { data: decryptedBinary } = await openpgp.decrypt({
            message,
            decryptionKeys: privateKeyObj,
            format: 'binary'
          });

          // Lien de t√©l√©chargement du fichier d√©chiffr√©
          const originalName = file.name.replace(/\.pgp$/i, '') || 'decrypted.dat';
          const blob = new Blob([decryptedBinary]);
          const linkDec = document.createElement('a');
          linkDec.href = URL.createObjectURL(blob);
          linkDec.download = originalName;
          linkDec.textContent = '‚¨áÔ∏è T√©l√©charger le d√©chiffr√©';
          linkDec.className = 'text-red-400 hover:underline';

          decResult.append(linkDec);

        } catch (err) {
          alert('Erreur lors du d√©chiffrement : ' + err.message);
        }
      });
    });
  </script>
</body>
</html>


