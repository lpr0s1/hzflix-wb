<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>cryptedhype – Chiffrement & Déchiffrement</title>
  <meta name="description" content="cryptedhype : chiffrez et déchiffrez vos fichiers (.txt, .pdf, .jpg, .apk…) en PGP directement dans votre navigateur.">
  <meta name="keywords" content="PGP,chiffrement,cryptographie,fichiers,openpgp">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#ff0000">
  <meta property="og:title" content="cryptedhype">
  <meta property="og:description" content="Chiffrez et déchiffrez vos fichiers en PGP sans quitter la page.">
  <meta property="og:url" content="https://hzflix.online/cryptedhype">
  <meta property="og:type" content="website">

  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-900 text-gray-100 flex flex-col items-center p-6">

  <h1 class="text-4xl font-bold mb-8 text-red-600">cryptedhype</h1>

  <!-- Section chiffrement -->
  <section id="encrypt-section" class="w-full max-w-md mb-12">
    <h2 class="text-2xl mb-4 text-red-600">Chiffrer un fichier</h2>
    <input
      id="encrypt-input"
      type="file"
      class="w-full mb-4 text-sm file:bg-red-600 file:text-white file:px-4 file:py-2 file:rounded"
    />
    <div id="encrypt-result" class="flex flex-col space-y-4"></div>
  </section>

  <!-- Section déchiffrement -->
  <section id="decrypt-section" class="w-full max-w-md">
    <h2 class="text-2xl mb-4 text-red-600">Déchiffrer un fichier</h2>
    <input
      id="decrypt-input"
      type="file"
      class="w-full mb-2 text-sm file:bg-red-600 file:text-white file:px-4 file:py-2 file:rounded"
    />
    <textarea
      id="private-key"
      rows="4"
      placeholder="Collez ici votre clé privée PGP"
      class="w-full mb-4 p-2 bg-gray-800 text-sm text-white rounded"
    ></textarea>
    <button
      id="decrypt-btn"
      class="w-full px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors duration-200"
    >
      Déchiffrer
    </button>
    <div id="decrypt-result" class="flex flex-col space-y-4 mt-4"></div>
  </section>

  <!-- OpenPGP.js -->
  <script src="https://cdn.jsdelivr.net/npm/openpgp@5.7.1/dist/openpgp.min.js"></script>
  <script>
    // ——— CHIFFREMENT ———
    document.getElementById("encrypt-input").addEventListener("change", async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const resultEl = document.getElementById("encrypt-result");
      resultEl.innerHTML = "";

      try {
        // Lecture du fichier en binaire
        const data = new Uint8Array(await file.arrayBuffer());

        // Génération de la paire PGP (sans passphrase)
        const { privateKey: privArmored, publicKey: pubArmored } =
          await openpgp.generateKey({
            userIDs: [{ name: "cryptedhype User", email: "user@hzflix.online" }],
            curve: "curve25519"
          });

        // Préparer message binaire
        const message = await openpgp.createMessage({ binary: data });

        // Clé publique prête à l’emploi
        const publicKey = await openpgp.readKey({ armoredKey: pubArmored });

        // Chiffrement en binaire
        const encryptedBinary = await openpgp.encrypt({
          message,
          encryptionKeys: publicKey,
          format: "binary"
        });

        // Lien de téléchargement du .pgp
        const blob = new Blob([encryptedBinary], { type: "application/pgp-encrypted" });
        const linkEnc = document.createElement("a");
        linkEnc.href = URL.createObjectURL(blob);
        linkEnc.download = file.name + ".pgp";
        linkEnc.textContent = "Télécharger le fichier chiffré";
        linkEnc.className = "text-red-400 hover:underline";

        // Affichage de la clé privée + bouton copier
        const wrapper = document.createElement("div");
        wrapper.className = "flex flex-col";

        const pre = document.createElement("pre");
        pre.textContent = privArmored;
        pre.className = "bg-gray-800 text-white p-2 text-sm overflow-auto max-h-48 whitespace-pre-wrap break-all rounded";

        const copyBtn = document.createElement("button");
        copyBtn.textContent = "Copier la clé privée";
        copyBtn.className = "mt-2 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors duration-200";
        copyBtn.addEventListener("click", () => {
          navigator.clipboard.writeText(privArmored);
          copyBtn.textContent = "Clé copiée !";
        });

        wrapper.append(pre, copyBtn);
        resultEl.append(linkEnc, wrapper);

      } catch (err) {
        alert("Erreur lors du chiffrement : " + err.message);
      }
    });

    // ——— DÉCHIFFREMENT ———
    document.getElementById("decrypt-btn").addEventListener("click", async () => {
      const fileInput = document.getElementById("decrypt-input");
      const privArmored = document.getElementById("private-key").value.trim();

      if (!fileInput.files.length || !privArmored) {
        return alert("Veuillez fournir le fichier chiffré et la clé privée.");
      }

      const resultEl = document.getElementById("decrypt-result");
      resultEl.innerHTML = "";

      try {
        const file = fileInput.files[0];
        const encryptedData = new Uint8Array(await file.arrayBuffer());

        // Lecture de la clé privée
        const privateKey = await openpgp.readPrivateKey({ armoredKey: privArmored });

        // Lecture du message chiffré
        const message = await openpgp.readMessage({ binaryMessage: encryptedData });

        // Déchiffrement en binaire
        const { data: decryptedBinary } = await openpgp.decrypt({
          message,
          decryptionKeys: privateKey,
          format: "binary"
        });

        // Lien de téléchargement du fichier déchiffré
        const originalName = file.name.replace(/\.pgp$/i, "") || "decrypted.dat";
        const blob = new Blob([decryptedBinary]);
        const linkDec = document.createElement("a");
        linkDec.href = URL.createObjectURL(blob);
        linkDec.download = originalName;
        linkDec.textContent = "Télécharger le fichier déchiffré";
        linkDec.className = "text-red-400 hover:underline";

        resultEl.append(linkDec);

      } catch (err) {
        alert("Erreur lors du déchiffrement : " + err.message);
      }
    });
  </script>
</body>
</html>

