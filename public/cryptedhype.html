<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>cryptedhype – Chiffrement & Déchiffrement de fichiers</title>
  <meta name="description" content="cryptedhype : chiffrez et déchiffrez vos fichiers (.txt, .pdf, .jpg, .apk…) en PGP directement dans votre navigateur.">
  <meta name="keywords" content="PGP,chiffrement,fichiers,cryptographie,encrypted,security">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#ff0000">
  <meta property="og:title" content="cryptedhype">
  <meta property="og:description" content="Chiffrez et déchiffrez vos fichiers en PGP sans quitter la page.">
  <meta property="og:url" content="https://hzflix.online/cryptedhype">
  <meta property="og:type" content="website">

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: #111;
      color: #eee;
    }
    .accent {
      color: #ff0000;
    }
    .btn {
      @apply px-4 py-2 rounded font-semibold transition-all;
    }
    .btn-red {
      @apply bg-red-600 hover:bg-red-700 text-white;
    }
    .dialog {
      @apply fixed inset-0 bg-black/80 flex items-center justify-center p-4;
    }
    /* Préserve le fond sombre et le texte blanc */
    pre.privkey {
      @apply text-white bg-transparent p-2 text-sm overflow-auto;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center p-6">

  <h1 class="text-4xl font-bold mb-8 accent">cryptedhype</h1>

  <!-- Section chiffrement -->
  <section id="encrypt-section" class="w-full max-w-md mb-12">
    <h2 class="text-2xl mb-4 accent">Chiffrer un fichier</h2>
    <input
      type="file"
      id="file-to-encrypt"
      class="mb-4 w-full text-sm file:bg-red-600 file:text-white file:py-2 file:px-4 file:rounded"
    />
    <div id="encrypt-result" class="space-y-4"></div>
  </section>

  <!-- Section déchiffrement -->
  <section id="decrypt-section" class="w-full max-w-md">
    <h2 class="text-2xl mb-4 accent">Déchiffrer un fichier</h2>
    <input
      type="file"
      id="file-to-decrypt"
      class="mb-2 w-full text-sm file:bg-red-600 file:text-white file:py-2 file:px-4 file:rounded"
    />
    <textarea
      id="private-key"
      rows="4"
      placeholder="Collez ici votre clé privée PGP"
      class="mb-4 w-full p-2 bg-gray-900 text-sm text-white"
    ></textarea>
    <button id="decrypt-btn" class="btn btn-red w-full">Déchiffrer</button>
    <div id="decrypt-result" class="mt-4"></div>
  </section>

  <!-- Librairies externes -->
  <script src="https://cdn.jsdelivr.net/npm/openpgp@5.7.0/dist/openpgp.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

  <script>
    // Fonction utilitaire pour décrypter un paramètre URL (chiffré côté client)
    const URL_SECRET = "hzflixParamKey";
    function getDecryptedParam(param) {
      const raw = new URLSearchParams(location.search).get(param);
      if (!raw) return null;
      try {
        const bytes = CryptoJS.AES.decrypt(raw, URL_SECRET);
        return bytes.toString(CryptoJS.enc.Utf8);
      } catch {
        return null;
      }
    }
    // Masquer/en afficher des sections selon token chiffré
    const mode = getDecryptedParam("token");
    if (mode === "dec") {
      document.getElementById("encrypt-section").classList.add("hidden");
    } else if (mode === "enc") {
      document.getElementById("decrypt-section").classList.add("hidden");
    }

    // Quand l'utilisateur sélectionne un fichier, on génère la clé et on chiffre
    document.getElementById("file-to-encrypt").addEventListener("change", async (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const data = new Uint8Array(await file.arrayBuffer());

      // Génération de la paire PGP
      const { privateKey, publicKey } = await openpgp.generateKey({
        userIDs: [{ name: "cryptedhype User", email: "user@hzflix.online" }],
        curve: "curve25519"
      });

      // Chiffrement
      const encrypted = await openpgp.encrypt({
        message: await openpgp.Message.fromBinary(data),
        encryptionKeys: await openpgp.readKey({ armoredKey: publicKey }),
        config: { allowUnauthenticatedStream: true }
      });

      // Préparer le lien de téléchargement du fichier chiffré
      const blob = new Blob([encrypted], { type: "application/pgp-encrypted" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.download = file.name + ".pgp";
      link.textContent = "Télécharger le fichier chiffré";
      link.className = "text-red-400 hover:underline";

      // Afficher la clé privée automatiquement (texte en blanc)
      const pre = document.createElement("pre");
      pre.textContent = privateKey;
      pre.className = "privkey";

      // Bouton "Copier"
      const copyBtn = document.createElement("button");
      copyBtn.textContent = "Copier la clé privée";
      copyBtn.className = "btn btn-red";
      copyBtn.onclick = () => navigator.clipboard.writeText(privateKey);

      const result = document.getElementById("encrypt-result");
      result.innerHTML = "";
      result.append(link, pre, copyBtn);
    });

    // Déchiffrement
    document.getElementById("decrypt-btn").addEventListener("click", async () => {
      const fileInput = document.getElementById("file-to-decrypt");
      const privKeyArmored = document.getElementById("private-key").value.trim();
      if (!fileInput.files.length || !privKeyArmored) {
        return alert("Veuillez fournir le fichier chiffré et la clé privée.");
      }
      const file = fileInput.files[0];
      const encryptedData = await file.arrayBuffer();

      // Lecture de la clé privée
      const privateKeyObj = await openpgp.readPrivateKey({ armoredKey: privKeyArmored });

      // Lecture du message chiffré
      const message = await openpgp.readMessage({ binaryMessage: new Uint8Array(encryptedData) });
      const { data: decrypted } = await openpgp.decrypt({
        message,
        decryptionKeys: privateKeyObj,
        format: "binary"
      });

      // Préparer lien de téléchargement du fichier déchiffré
      const outName = file.name.replace(/\.pgp$/i, "") || "decrypted.dat";
      const blob = new Blob([decrypted]);
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.download = outName;
      link.textContent = "Télécharger le fichier déchiffré";
      link.className = "text-red-400 hover:underline";

      const result = document.getElementById("decrypt-result");
      result.innerHTML = "";
      result.append(link);
    });
  </script>
</body>
</html>

