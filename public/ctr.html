<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Risque de Contrôle</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-red-500 min-h-screen flex flex-col items-center justify-start p-4 space-y-6">
<div class="w-full max-w-2xl text-center">
<select id="citySelect" class="text-black p-2 rounded mb-4">
<option value="lille">Lille</option>
<option value="valenciennes">Valenciennes</option>
<option value="dunkerque">Dunkerque</option>
<option value="arras">Arras</option>
<option value="roubaix">Roubaix</option>
<option value="tourcoing">Tourcoing</option>
<option value="douai">Douai</option>
<option value="lens">Lens</option>
<option value="bethune">Béthune</option>
<option value="hazebrouck">Hazebrouck</option>
</select>
<h1 class="text-4xl font-bold">Risque de Contrôle</h1>
<p id="riskPercent" class="text-7xl mt-4">Calcul du risque...</p>
<div id="sources" class="mt-6 text-left space-y-2"></div>
</div>
<script>
const sitesBase = [
{url:'https://www.lavoixdunord.fr/region/lille-et-environs',conf:90}, // Lille
{url:'https://www.lavoixdunord.fr/region/valenciennes-et-environs',conf:85}, // Valenciennes
{url:'https://www.lavoixdunord.fr/region/dunkerque-et-environs',conf:80}, // Dunkerque
{url:'https://www.lavoixdunord.fr/region/arras-et-environs',conf:80}, // Arras
{url:'https://www.lavoixdunord.fr/region/roubaix-et-environs',conf:85}, // Roubaix
{url:'https://www.lavoixdunord.fr/region/tourcoing-et-environs',conf:80}, // Tourcoing
{url:'https://www.lavoixdunord.fr/region/douai-et-environs',conf:80}, // Douai
{url:'https://www.lavoixdunord.fr/region/lens-et-environs',conf:85}, // Lens
{url:'https://www.lavoixdunord.fr/region/bethune-et-environs',conf:85}, // Béthune
{url:'https://www.lavoixdunord.fr/region/hazebrouck-et-environs',conf:70}, // Hazebrouck
];

const motsCles = ['contrôle','police','barrage','radar','filtrage','sécurité routière','opération de contrôle','alcoolémie','intervention','contrôle routier','vérifications','opération anti-drogue','patrouille','poursuite','poste de contrôle'];

const cityUrls = {
  "lille": [
    'https://www.lavoixdunord.fr/region/lille-et-environs',
    'https://www.france3-regions.francetvinfo.fr/hauts-de-france/lille',
    'https://actu.fr/hauts-de-france/lille',
    'https://radars.securite-routiere.gouv.fr/lille',
    'https://www.lavoixdunord.fr/region/lens-et-environs',
  ],
  "valenciennes": [
    'https://www.lavoixdunord.fr/region/valenciennes-et-environs',
    'https://www.lavoixdunord.fr/region/valenciennes',
    'https://www.france3-regions.francetvinfo.fr/hauts-de-france/valenciennes',
    'https://radars.securite-routiere.gouv.fr/valenciennes',
  ],
  "dunkerque": [
    'https://www.lavoixdunord.fr/region/dunkerque-et-environs',
    'https://www.france3-regions.francetvinfo.fr/hauts-de-france/dunkerque',
    'https://actu.fr/hauts-de-france/dunkerque',
    'https://radars.securite-routiere.gouv.fr/dunkerque',
  ],
  "arras": [
    'https://www.lavoixdunord.fr/region/arras-et-environs',
    'https://www.france3-regions.francetvinfo.fr/hauts-de-france/arras',
    'https://actu.fr/hauts-de-france/arras',
    'https://radars.securite-routiere.gouv.fr/arras',
  ],
  "roubaix": [
    'https://www.lavoixdunord.fr/region/roubaix-et-environs',
    'https://www.france3-regions.francetvinfo.fr/hauts-de-france/roubaix',
    'https://actu.fr/hauts-de-france/roubaix',
    'https://radars.securite-routiere.gouv.fr/roubaix',
  ],
  "tourcoing": [
    'https://www.lavoixdunord.fr/region/tourcoing-et-environs',
    'https://www.france3-regions.francetvinfo.fr/hauts-de-france/tourcoing',
    'https://actu.fr/hauts-de-france/tourcoing',
    'https://radars.securite-routiere.gouv.fr/tourcoing',
  ],
  "douai": [
    'https://www.lavoixdunord.fr/region/douai-et-environs',
    'https://www.france3-regions.francetvinfo.fr/hauts-de-france/douai',
    'https://actu.fr/hauts-de-france/douai',
    'https://radars.securite-routiere.gouv.fr/douai',
  ],
  "lens": [
    'https://www.lavoixdunord.fr/region/lens-et-environs',
    'https://www.france3-regions.francetvinfo.fr/hauts-de-france/lens',
    'https://actu.fr/hauts-de-france/lens',
    'https://radars.securite-routiere.gouv.fr/lens',
  ],
  "bethune": [
    'https://www.lavoixdunord.fr/region/bethune-et-environs',
    'https://www.france3-regions.francetvinfo.fr/hauts-de-france/bethune',
    'https://actu.fr/hauts-de-france/bethune',
    'https://radars.securite-routiere.gouv.fr/bethune',
  ],
  "hazebrouck": [
    'https://www.lavoixdunord.fr/region/hazebrouck-et-environs',
    'https://www.france3-regions.francetvinfo.fr/hauts-de-france/hazebrouck',
    'https://actu.fr/hauts-de-france/hazebrouck',
    'https://radars.securite-routiere.gouv.fr/hazebrouck',
  ],
};

async function scrapSites() {
  const city = document.getElementById('citySelect').value;
  const urls = cityUrls[city] || [];
  let totalScore = 0;
  let sourcesHTML = '';
  for (let siteUrl of urls) {
    try {
      const response = await fetch('https://api.allorigins.win/raw?url=' + encodeURIComponent(siteUrl));
      const text = await response.text();
      let match = false;
      for (let mot of motsCles) {
        if (text.toLowerCase().includes(mot) && text.toLowerCase().includes(city)) {
          match = true;
          break;
        }
      }
      if (match) {
        totalScore += 10;
        sourcesHTML += `<div class="mt-2">✅ ${siteUrl} (+10%)</div>`;
      } else {
        sourcesHTML += `<div class="mt-2 text-gray-500">❌ ${siteUrl}</div>`;
      }
    } catch (e) {
      sourcesHTML += `<div class="mt-2 text-gray-500">❌ ${siteUrl} (Erreur d'accès)</div>`;
    }
  }
  
  const now = new Date();
  const heure = now.getHours();
  if (heure >= 7 && heure <= 9) totalScore += 5;
  if (heure >= 16 && heure <= 19) totalScore += 5;
  if (heure >= 22 || heure <= 4) totalScore += 10;
  const jour = now.getDay();
  if (jour === 5 || jour === 6) totalScore += 10;
  
  totalScore += 20;
  if (totalScore > 100) totalScore = 100;
  document.getElementById('riskPercent').innerText = Math.round(totalScore) + '%';
  document.getElementById('sources').innerHTML = sourcesHTML;
}

scrapSites();
setInterval(scrapSites, 60000);
</script>
</body>
</html>
