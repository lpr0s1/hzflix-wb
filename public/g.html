<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<title>SpaceGame Procedural Ship</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<style>
html,body{margin:0;height:100%;background:#000;user-select:none}
canvas{display:block}
#loader{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#fff;font-family:system-ui,Arial;z-index:10}
.joystick{position:fixed;left:16px;bottom:16px;width:100px;height:100px;border-radius:50%;background:rgba(255,255,255,0.06);touch-action:none}
.joystick-inner{width:50px;height:50px;border-radius:50%;background:rgba(255,255,255,0.18);position:relative;left:25px;top:25px;pointer-events:none}
.btn{position:fixed;right:16px;width:60px;height:60px;border-radius:50%;background:rgba(255,255,255,0.08);text-align:center;line-height:60px;color:#fff}
.btn.up{bottom:96px}.btn.down{bottom:16px}
</style>
</head>
<body>
<div id="loader">Chargement...</div>
<div class="joystick" id="joystick"><div class="joystick-inner" id="joyInner"></div></div>
<div class="btn up" id="btnUp">↑</div>
<div class="btn down" id="btnDown">↓</div>
<script type="module">
import * as THREE from 'https://unpkg.com/three@0.152.2/build/three.module.js';
const loaderEl = document.getElementById('loader');
const texUrls = {
  earth:'https://rawcdn.githack.com/mrdoob/three.js/dev/examples/textures/planets/earth_atmos_2048.jpg',
  clouds:'https://rawcdn.githack.com/mrdoob/three.js/dev/examples/textures/planets/earth_clouds_1024.png',
  moon:'https://rawcdn.githack.com/mrdoob/three.js/dev/examples/textures/planets/moon_1024.jpg'
};
const texLoader = new THREE.TextureLoader();
async function loadSafe(url){ try{return await texLoader.loadAsync(url);}catch(e){return null;} }
const [earthTex,cloudsTex,moonTex] = await Promise.all([loadSafe(texUrls.earth),loadSafe(texUrls.clouds),loadSafe(texUrls.moon)]);
loaderEl.style.display='none';
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000010);
const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 5000);
camera.position.set(0,4,12);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setPixelRatio(Math.min(devicePixelRatio||1,2));
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);
scene.add(new THREE.AmbientLight(0x666666));
const sun = new THREE.PointLight(0xffffff,2); sun.position.set(0,0,0); scene.add(sun);
scene.add(new THREE.Mesh(new THREE.SphereGeometry(6,32,32), new THREE.MeshBasicMaterial({color:0xffffcc})));
const earth = new THREE.Mesh(new THREE.SphereGeometry(4.5,64,64), new THREE.MeshPhongMaterial({map:earthTex, shininess:5}));
earth.position.set(40,0,0); scene.add(earth);
const clouds = new THREE.Mesh(new THREE.SphereGeometry(4.55,64,64), new THREE.MeshPhongMaterial({map:cloudsTex, transparent:true, depthWrite:false, opacity:0.9}));
earth.add(clouds);
const moon = new THREE.Mesh(new THREE.SphereGeometry(1.1,32,32), new THREE.MeshPhongMaterial({map:moonTex}));
moon.position.set(7,0,0); earth.add(moon);
(function(){const g=new THREE.BufferGeometry();const n=1500;const p=new Float32Array(n*3);for(let i=0;i<n;i++){p[i*3]=(Math.random()-0.5)*2000;p[i*3+1]=(Math.random()-0.5)*2000;p[i*3+2]=(Math.random()-0.5)*2000;}g.setAttribute('position',new THREE.BufferAttribute(p,3));scene.add(new THREE.Points(g,new THREE.PointsMaterial({color:0x99ddff,size:1.5,transparent:true,opacity:0.9})));})();
function assembleShip(){const group=new THREE.Group();const bodyMat=new THREE.MeshStandardMaterial({color:0xff5555,metalness:0.6,roughness:0.25});const body=new THREE.Mesh(new THREE.ConeGeometry(0.6,2.2,24),bodyMat);body.rotation.x=Math.PI/2;group.add(body);const glass=new THREE.Mesh(new THREE.SphereGeometry(0.42,18,18),new THREE.MeshPhysicalMaterial({color:0x3333ff,transmission:0.6,transparent:true,opacity:0.95}));glass.position.set(0,0.45,0.6);group.add(glass);const wingMat=bodyMat.clone();const wingL=new THREE.Mesh(new THREE.BoxGeometry(0.12,0.5,1.2),wingMat);wingL.position.set(-0.9,0,-0.2);wingL.rotation.z=0.06;const wingR=wingL.clone();wingR.position.set(0.9,0,-0.2);group.add(wingL,wingR);const fin=new THREE.Mesh(new THREE.BoxGeometry(0.06,0.6,0.8),wingMat);fin.position.set(0,-0.6,-0.2);fin.rotation.x=0.18;group.add(fin);const engineMat=new THREE.MeshStandardMaterial({color:0x222222,metalness:0.8,roughness:0.2});const thrL=new THREE.Mesh(new THREE.CylinderGeometry(0.12,0.12,0.5,12),engineMat);thrL.rotation.x=Math.PI/2;thrL.position.set(-0.35,-1.05,0);const thrR=thrL.clone();thrR.position.set(0.35,-1.05,0);group.add(thrL,thrR);const ringMat=new THREE.MeshBasicMaterial({color:0xffaa00,transparent:true,opacity:0.9});const ringL=new THREE.Mesh(new THREE.TorusGeometry(0.16,0.03,8,32),ringMat);ringL.rotation.x=Math.PI/2;ringL.position.copy(thrL.position);const ringR=ringL.clone();ringR.position.copy(thrR.position);group.add(ringL,ringR);const exhaustCount=60;const arr=new Float32Array(exhaustCount*3);for(let i=0;i<exhaustCount;i++){arr[i*3]=(Math.random()-0.5)*0.2;arr[i*3+1]=-1.4-Math.random()*0.6;arr[i*3+2]=(Math.random()-0.5)*0.2;}const exhaustGeom=new THREE.BufferGeometry();exhaustGeom.setAttribute('position',new THREE.BufferAttribute(arr,3));const exhaustMat=new THREE.PointsMaterial({color:0xffaa66,size:0.08,transparent:true,opacity:0.9,depthWrite:false});const exhaust=new THREE.Points(exhaustGeom,exhaustMat);group.add(exhaust);const l1=new THREE.PointLight(0xffaa66,0.6,6);l1.position.set(-0.35,-1.05,0);const l2=l1.clone();l2.position.set(0.35,-1.05,0);group.add(l1,l2);group.userData={setThrusterPower(p){const power=Math.max(0,Math.min(1,p));exhaustMat.size=0.04+power*0.18;exhaustMat.opacity=0.25+power*0.75;l1.intensity=0.2+power*1.2;l2.intensity=0.2+power*1.2;ringMat.opacity=0.2+power*0.8},updateExhaust(){const a=exhaustGeom.attributes.position.array;for(let i=0;i<a.length/3;i++){const idx=i*3;a[idx]+= (Math.random()-0.5)*0.002;a[idx+1]-=0.002-Math.random()*0.004;a[idx+2]+=(Math.random()-0.5)*0.002;if(a[idx+1]<-2.2) a[idx+1]=-1.4-Math.random()*0.6;}exhaustGeom.attributes.position.needsUpdate=true}};return group}
let ship=assembleShip();ship.position.set(0,0,0);scene.add(ship);
let move={x:0,y:0,up:false,down:false};
const joy=document.getElementById('joystick');const joyInner=document.getElementById('joyInner');
joy.addEventListener('touchstart',e=>e.preventDefault());
joy.addEventListener('touchmove',e=>{const t=e.touches[0];const r=joy.getBoundingClientRect();move.x=Math.max(-1,Math.min(1,(t.clientX-(r.left+r.width/2))/(r.width/2)));move.y=Math.max(-1,Math.min(1,-(t.clientY-(r.top+r.height/2))/(r.height/2)));joyInner.style.transform=`translate(${move.x*25}px, ${-move.y*25}px)`;});
joy.addEventListener('touchend',()=>{move.x=0;move.y=0;joyInner.style.transform='translate(0,0)';});
document.getElementById('btnUp').addEventListener('touchstart',()=>move.up=true);
document.getElementById('btnUp').addEventListener('touchend',()=>move.up=false);
document.getElementById('btnDown').addEventListener('touchstart',()=>move.down=true);
document.getElementById('btnDown').addEventListener('touchend',()=>move.down=false);
let velocity=new THREE.Vector3();let direction=new THREE.Vector3();const forward=new THREE.Vector3(0,0,-1);
function animate(){requestAnimationFrame(animate);const t=Date.now()*0.00005;earth.position.x=40*Math.cos(t);earth.position.z=40*Math.sin(t);clouds.rotation.y+=0.0006;moon.rotation.y+=0.0012;direction.set(0,0,0);const localF=forward.clone().applyEuler(ship.rotation);direction.add(localF.multiplyScalar(move.y*0.25));if(move.up)direction.y+=0.12;if(move.down)direction.y-=0.12;velocity.lerp(direction,0.08);ship.position.add(velocity);ship.rotation.y-=move.x*0.04;const thrusterPower=Math.min(1,Math.abs(move.y));if(ship.userData&&ship.userData.setThrusterPower)ship.userData.setThrusterPower(thrusterPower);if(ship.userData&&ship.userData.updateExhaust)ship.userData.updateExhaust();const desired=ship.position.clone().add(new THREE.Vector3(0,3,8).applyEuler(ship.rotation));camera.position.lerp(desired,0.12);camera.lookAt(ship.position);renderer.render(scene,camera)}
animate();
window.addEventListener('resize',()=>{camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight);});
</script>
</body>
</html>

