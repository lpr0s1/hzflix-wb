<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Simulateur Spatial Mobile</title>
<style>
  html, body { margin: 0; padding: 0; overflow: hidden; -webkit-user-select: none; touch-action: none; background-color: black; }
  canvas { display: block; }

  /* Contrôles tactiles discrets */
  .joystick {
    position: absolute;
    bottom: 20px;
    left: 20px;
    width: 100px; height: 100px;
    border-radius: 50%;
    background: rgba(255,255,255,0.1);
    touch-action: none;
  }

  .joystick-inner {
    position: absolute;
    width: 50px; height: 50px;
    border-radius: 50%;
    background: rgba(255,255,255,0.3);
    top: 25px; left: 25px;
  }

  .btn {
    position: absolute;
    width: 60px; height: 60px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    text-align: center;
    line-height: 60px;
    font-weight: bold;
    color: white;
    user-select: none;
  }

  .btn.up { bottom: 100px; right: 20px; }
  .btn.down { bottom: 20px; right: 20px; }
</style>
</head>
<body>
<div class="joystick" id="joystick"><div class="joystick-inner" id="joyInner"></div></div>
<div class="btn up" id="btnUp">↑</div>
<div class="btn down" id="btnDown">↓</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.162.0/build/three.min.js"></script>
<script>
  // ================== Initialisation ==================
  const scene = new THREE.Scene();

  const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 10000);
  camera.position.set(0, 5, 20);

  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Lumière
  const light = new THREE.PointLight(0xffffff, 2);
  light.position.set(0,0,0);
  scene.add(light);

  // Soleil
  const sun = new THREE.Mesh(
    new THREE.SphereGeometry(10, 32, 32),
    new THREE.MeshBasicMaterial({ color: 0xffff00 })
  );
  scene.add(sun);

  // Terre
  const earth = new THREE.Mesh(
    new THREE.SphereGeometry(5, 32, 32),
    new THREE.MeshStandardMaterial({ color: 0x0000ff })
  );
  earth.position.set(50,0,0);
  scene.add(earth);

  // Vaisseau
  const ship = new THREE.Mesh(
    new THREE.ConeGeometry(1,3,8),
    new THREE.MeshStandardMaterial({ color: 0xff0000 })
  );
  ship.rotation.x = Math.PI/2;
  scene.add(ship);

  // Étoiles
  const starGeometry = new THREE.BufferGeometry();
  const starCount = 5000;
  const positions = [];
  for(let i=0;i<starCount;i++){
    positions.push((Math.random()-0.5)*2000);
    positions.push((Math.random()-0.5)*2000);
    positions.push((Math.random()-0.5)*2000);
  }
  starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(positions,3));
  const stars = new THREE.Points(starGeometry, new THREE.PointsMaterial({ color:0xffffff }));
  scene.add(stars);

  // ================== Contrôles tactiles ==================
  let move = {x:0, y:0, up:false, down:false};
  const joy = document.getElementById('joystick');
  const joyInner = document.getElementById('joyInner');

  joy.addEventListener('touchstart', e=>e.preventDefault());
  joy.addEventListener('touchmove', e=>{
    const touch = e.touches[0];
    const rect = joy.getBoundingClientRect();
    const dx = touch.clientX - (rect.left + rect.width/2);
    const dy = touch.clientY - (rect.top + rect.height/2);
    const max = rect.width/2;
    move.x = Math.max(-1,Math.min(1,dx/max));
    move.y = Math.max(-1,Math.min(1,-dy/max));
    joyInner.style.transform = `translate(${move.x*25}px, ${-move.y*25}px)`;
  });
  joy.addEventListener('touchend', e=>{
    move.x=0; move.y=0;
    joyInner.style.transform = 'translate(0px,0px)';
  });

  document.getElementById('btnUp').addEventListener('touchstart', ()=>move.up=true);
  document.getElementById('btnUp').addEventListener('touchend', ()=>move.up=false);
  document.getElementById('btnDown').addEventListener('touchstart', ()=>move.down=true);
  document.getElementById('btnDown').addEventListener('touchend', ()=>move.down=false);

  // ================== Animation ==================
  let velocity = new THREE.Vector3();
  function animate(){
    requestAnimationFrame(animate);

    // Pilotage
    const speed = 0.2;
    const rotationSpeed = 0.05;
    ship.rotation.z -= move.x * rotationSpeed;
    ship.rotation.x -= move.y * rotationSpeed;

    const forward = new THREE.Vector3(0,0,-1).applyEuler(ship.rotation);
    velocity.add(forward.clone().multiplyScalar(move.y * speed));
    if(move.up) velocity.y += speed*0.5;
    if(move.down) velocity.y -= speed*0.5;

    ship.position.add(velocity);
    velocity.multiplyScalar(0.95); // friction légère

    // Caméra suit le vaisseau
    camera.position.lerp(ship.position.clone().add(new THREE.Vector3(0,5,20).applyEuler(ship.rotation)), 0.1);
    camera.lookAt(ship.position);

    // Rotation Terre autour du soleil
    earth.position.x = 50 * Math.cos(Date.now()*0.0005);
    earth.position.z = 50 * Math.sin(Date.now()*0.0005);

    renderer.render(scene,camera);
  }
  animate();

  window.addEventListener('resize', ()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>
</body>
</html>
