<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SpaceGame - Vaisseau GLB</title>
<style>
  html,body{margin:0;height:100%;background:#000;overflow:hidden}
  canvas{display:block}
  #loader{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#fff;font-family:sans-serif;z-index:10}
  .ui{position:absolute;left:12px;bottom:12px;z-index:11}
  .btn{display:inline-block;padding:10px 14px;margin:6px;background:rgba(255,255,255,0.08);color:#fff;border-radius:8px}
</style>
</head>
<body>
<div id="loader">Chargement des ressources...</div>
<div class="ui">
  <div id="joy" style="width:100px;height:100px;border-radius:50%;background:rgba(255,255,255,0.06);touch-action:none"></div>
  <div style="margin-top:8px">
    <span class="btn" id="up">↑</span>
    <span class="btn" id="down">↓</span>
  </div>
</div>

<script type="module">
import * as THREE from 'https://unpkg.com/three@0.152.2/build/three.module.js';
import { GLTFLoader } from 'https://unpkg.com/three@0.152.2/examples/jsm/loaders/GLTFLoader.js';

const loaderEl = document.getElementById('loader');
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000010);
const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 5000);
camera.position.set(0,3,10);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setPixelRatio(Math.min(devicePixelRatio||1,2));
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0x666666));
const sun = new THREE.PointLight(0xffffff,2); sun.position.set(0,0,0); scene.add(sun);
scene.add(new THREE.Mesh(new THREE.SphereGeometry(8,32,32), new THREE.MeshBasicMaterial({color:0xffffcc})));

const texLoader = new THREE.TextureLoader();
const earthTex = await texLoader.loadAsync('https://rawcdn.githack.com/mrdoob/three.js/dev/examples/textures/planets/earth_atmos_2048.jpg').catch(()=>null);
const cloudsTex = await texLoader.loadAsync('https://rawcdn.githack.com/mrdoob/three.js/dev/examples/textures/planets/earth_clouds_1024.png').catch(()=>null);
const moonTex = await texLoader.loadAsync('https://rawcdn.githack.com/mrdoob/three.js/dev/examples/textures/planets/moon_1024.jpg').catch(()=>null);

const earth = new THREE.Mesh(new THREE.SphereGeometry(5,64,64), new THREE.MeshPhongMaterial({map:earthTex, shininess:5}));
earth.position.set(50,0,0); scene.add(earth);
const clouds = new THREE.Mesh(new THREE.SphereGeometry(5.05,64,64), new THREE.MeshPhongMaterial({map:cloudsTex, transparent:true, depthWrite:false, opacity:0.9}));
earth.add(clouds);
const moon = new THREE.Mesh(new THREE.SphereGeometry(1.3,32,32), new THREE.MeshPhongMaterial({map:moonTex}));
moon.position.set(8,0,0); earth.add(moon);

const starGeom = new THREE.BufferGeometry();
const starCount = 2000;
const pos = new Float32Array(starCount*3);
for(let i=0;i<starCount;i++){ pos[i*3]=(Math.random()-0.5)*2000; pos[i*3+1]=(Math.random()-0.5)*2000; pos[i*3+2]=(Math.random()-0.5)*2000; }
starGeom.setAttribute('position', new THREE.BufferAttribute(pos,3));
scene.add(new THREE.Points(starGeom, new THREE.PointsMaterial({color:0x99ddff,size:1.5,transparent:true,opacity:0.9})));

function withTimeout(p,ms,label){ return Promise.race([p, new Promise((_,rej)=>setTimeout(()=>rej(new Error('timeout '+label)), ms))]); }

// **VRAI** .glb public sur GitHub (rawcdn.githack) — remplace par ton .glb rawcdn.githack si besoin [9F742443-6C92-4C44-BF58-8F5A7C53B6F1](https://github.com/Gancus98/SpaceGame/blob/master/SpaceShip.glb?citationMarker=9F742443-6C92-4C44-BF58-8F5A7C53B6F1&citationId=49168075-3834-470F-8D6B-00ECF6D0976A&citationTitle=Github&citationFullTitle=Github&chatItemId=XtoCobA2jqGYkhNiQSovj).
const shipUrl = 'https://rawcdn.githack.com/Gancus98/SpaceGame/master/SpaceShip.glb';

let ship = null;
try{
  await withTimeout(fetch(shipUrl, {method:'HEAD', mode:'cors'}), 9000, 'HEAD');
  const loader = new GLTFLoader();
  const gltf = await withTimeout(new Promise((res,rej)=>loader.load(shipUrl, res, undefined, rej)), 25000, 'GLTF');
  ship = gltf.scene;
  ship.scale.set(0.6,0.6,0.6);
  ship.position.set(0,0,0);
  scene.add(ship);
}catch(e){
  // fallback geometry if network/CORS fails (ensures app never blocks)
  ship = new THREE.Group();
  const mat = new THREE.MeshStandardMaterial({color:0xff5555});
  const body = new THREE.Mesh(new THREE.ConeGeometry(0.8,2.5,16), mat); body.rotation.x = Math.PI/2;
  const wingL = new THREE.Mesh(new THREE.BoxGeometry(0.12,0.6,1.2), mat); wingL.position.set(-0.9,0,-0.2);
  const wingR = wingL.clone(); wingR.position.set(0.9,0,-0.2);
  ship.add(body, wingL, wingR);
  scene.add(ship);
}
loaderEl.style.display='none';

let move = {x:0,y:0,up:false,down:false};
const joy = document.getElementById('joy');
joy.addEventListener('pointerdown', e=>{ joy.setPointerCapture(e.pointerId); handle(e.clientX,e.clientY); });
window.addEventListener('pointermove', e=>{ if(e.buttons) handle(e.clientX,e.clientY); });
window.addEventListener('pointerup', ()=>{ move.x=0; move.y=0; });
function handle(cx,cy){
  const r = joy.getBoundingClientRect();
  move.x = Math.max(-1, Math.min(1, (cx - (r.left + r.width/2)) / (r.width/2)));
  move.y = Math.max(-1, Math.min(1, - (cy - (r.top + r.height/2)) / (r.height/2)));
}

document.getElementById('up').addEventListener('pointerdown', ()=> move.up=true);
document.getElementById('up').addEventListener('pointerup', ()=> move.up=false);
document.getElementById('down').addEventListener('pointerdown', ()=> move.down=true);
document.getElementById('down').addEventListener('pointerup', ()=> move.down=false);

const velocity = new THREE.Vector3(), direction = new THREE.Vector3(), forward = new THREE.Vector3(0,0,-1);
function animate(){
  requestAnimationFrame(animate);
  const t = Date.now()*0.00005;
  earth.position.x = 50 * Math.cos(t);
  earth.position.z = 50 * Math.sin(t);
  clouds.rotation.y += 0.0006;
  moon.rotation.y += 0.0012;
  direction.set(0,0,0);
  const localF = forward.clone().applyEuler(ship.rotation);
  direction.add(localF.multiplyScalar(move.y * 0.25));
  if(move.up) direction.y += 0.12;
  if(move.down) direction.y -= 0.12;
  velocity.lerp(direction, 0.08);
  ship.position.add(velocity);
  ship.rotation.y -= move.x * 0.04;
  const desired = ship.position.clone().add(new THREE.Vector3(0,3,8).applyEuler(ship.rotation));
  camera.position.lerp(desired, 0.12);
  camera.lookAt(ship.position);
  renderer.render(scene, camera);
}
animate();

window.addEventListener('resize', ()=>{ camera.aspect = innerWidth/innerHeight; camera.updateProjectionMatrix(); renderer.setSize(innerWidth, innerHeight); });
</script>
</body>
</html>


